ПАТТЕРН FLYWEIGHT (ПРИСПОСОБЛЕНЕЦ)

Название и классификация паттерна
Приспособленец — паттерн, структурирующий объекты.

Назначение
Применяет совместное использование для эффективной поддержки мно-
жества мелких объектов.

Мотивация
В некоторых приложениях использование объектов могло бы быть очень
полезным, но прямолинейная реализация оказывается недопустимо рас-
точительной.

Например, в большинстве редакторов документов имеются средства фор-
матирования и редактирования текстов, в той или иной степени модуль-
ные. Объектно-ориентированные редакторы обычно применяют объекты
для представления таких встроенных элементов, как таблицы и рисунки.
Но они не применяют объекты для представления каждого символа, не-
смотря на то что это увеличило бы гибкость на самых нижних уровнях
приложения — ведь тогда символы и встроенные элементы можно было бы
прорисовывать и форматировать по единым принципам, и для поддержки
новых наборов символов не пришлось бы как-либо затрагивать остальные
функции редактора. Вдобавок общая структура приложения отражала бы
физическую структуру документа. На следующей диаграмме показано,
как редактор документов мог бы воспользоваться объектами для пред -
ставления символов.
У такого дизайна есть один недостаток — затраты ресурсов. Даже в докумен-
те скромных размеров было бы несколько сотен тысяч объектов-символов,
а это привело бы к расходованию огромного объема памяти и неприемлемым
затратам во время выполнения. Паттерн приспособленец показывает, как
совместно использовать очень мелкие объекты без недопустимо высоких
затрат.

Приспособленец — это совместно используемый объект, который можно
задействовать одновременно в нескольких контекстах. В каждом контексте
он выглядит как независимый объект, то есть неотличим от экземпляра,
который не используется совместно. Приспособленцы не могут делать
предположений о контексте, в котором работают. Ключевая идея здесь —
различие между внутренним и внешним состояниями. Внутреннее со-
стояние хранится в самом приспособленце и состоит из информации, не
зависящей от его контекста. Именно поэтому он может использоваться
совместно. Внешнее состояние зависит от контекста и изменяется вместе
с ним, поэтому совместно не используется. Объекты-клиенты отвечают
за передачу внешнего состояния приспособленцу, когда в этом возникает
необходимость.
Приспособленцы моделируют концепции или сущности, число которых слиш-
ком велико для представления объектами. Например, редактор документов
мог бы создать по одному приспособленцу для каждой буквы алфавита.
Каждый приспособленец хранит код символа, но координаты положения
символа в документе и стиль его начертания определяются алгоритмами
размещения текста и командами форматирования, действующими в том
месте, где символ появляется. Код символа — это внутреннее состояние,
а все остальное — внешнее.

Структура
![flyweight](/images/flyweight.png)